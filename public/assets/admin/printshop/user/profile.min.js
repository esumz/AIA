/**
 * Created by HaThao on 7/9/14.
 */

var adminUserProfile = {

    init: function()
    {
        var profileForm = $('form.profile-info-form');
        var profilePasswordForm = $('form.profile-password-form');

        this.updateProfile(profileForm);
        this.updateProfile(profilePasswordForm, adminUserProfile.changePasswordCallBack);
        this.changeAvatar($('form#profileChangeAvatar'));
    },

    /**
     * Edit user
     *
     * @param table
     */
    updateProfile: function(form, callback) {

        form.ajaxForm({
            dataType: 'JSON',
            beforeSubmit: function() {
                $('button[type=submit]', form).button('loading');
            },
            success: function(data) {
                $('button[type=submit]', form).button('reset');
                var alertBox = $('.alert', form);

                if (data == true) {
                    $('.alert-content', alertBox).html('Successful');
                    alertBox.addClass('alert-success');

                    if (typeof callback != 'undefined') {
                        callback();
                    }
                } else {
                    $('.alert-content', alertBox).html('Have something went wrong');
                    alertBox.addClass('alert-warning');
                }
                alertBox.show();
            }
        });
    },

    /**
     * @param form
     */
    changePasswordCallBack: function(form)
    {
        $('input', form).each(function(i) {
            $(this).val('');
        });
    },

    /**
     * Change avatar
     *
     * @param form
     */
    changeAvatar: function(form)
    {
        form.ajaxForm({
            beforeSubmit: function() {
                $('button[type=submit]', form).button('loading');
            },
            success: function(data) {
                $('button[type=submit]', form).button('reset');
                var alertBox = $('.alert', form);

                if (data == true) {
                    $('.alert-content', alertBox).html('Successful');
                    alertBox.addClass('alert-success');

                    if (typeof callback != 'undefined') {
                        callback();
                    }
                } else {
                    $('.alert-content', alertBox).html('Have something went wrong');
                    alertBox.addClass('alert-warning');
                }
                alertBox.show();
            }
        });
    }

}

$(document).ready(function() {
    adminUserProfile.init();
});
